#!@PYTHON@

# Copyright (c) 2012 Giovanni Campagna <scampa.giovanni@gmail.com>
#
# Gnome Weather is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by the
# Free Software Foundation; either version 2 of the License, or (at your
# option) any later version.
#
# Gnome Clocks is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
# for more details.
#
# You should have received a copy of the GNU General Public License along
# with Gnome Weather; if not, write to the Free Software Foundation,
# Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA

import sys, os, re
import gettext

def add_to_envvar(var, value):
    if var in os.environ:
        os.environ[var] += ':' + value
    else:
        os.environ[var] = value

# HACK!
# We need to remove python2 directories that are added
# by jhbuild, or we end up loading pygobject for python 2!

newpath = []
for p in sys.path:
    is_python2 = False
    for d in p.split('/'):
        if d.startswith('python2'):
            is_python2 = True
            break
    if not is_python2:
        newpath.append(p)

sys.path = newpath

gettext.textdomain('@GETTEXT_PACKAGE@')

if os.path.exists('./src'):
   # running from source tree
   add_to_envvar('GI_TYPELIB_PATH', './lib')
   gettext.bindtextdomain('@GETTEXT_PACKAGE@', './po')
   pkgdatadir = './src'
else:
   add_to_envvar('GI_TYPELIB_PATH', '@pkglibdir@')
   gettext.bindtextdomain('@GETTEXT_PACKAGE@', '@localedir@')
   pkgdatadir = '@pkgdatadir@'

sys.path.append(pkgdatadir)
from gi.repository import GLib
from app import GnomeWeatherApp

class PathConfig:
      PKGDATADIR = pkgdatadir
      UIDIR = pkgdatadir + '/ui'

GLib.set_prgname('gnome-weather')
sys.exit(GnomeWeatherApp(PathConfig()).run(sys.argv))
